Стандарт модульных программ
========================
Стандарт модульных программ (анг. Standard modular program) - это стандарт обмена сообщениями между программами. Обмен сообщениями происходит при помощи сообщения Windows - WM_COPYDATA, на Linux - D-Bus?

<h2>Обмен сообщениями</h2>
Если нужно узнать статус программы, то мы отправляем ей сообщение "WORK" (чтобы найти handle для отправки, можно использовать, например, поиск по заголовку приложения ), после чего получаем ответ от нее в виде "YES&ID_HANDLE".
Перед отправкой сообщения "YES&ID_HANDLE" программа должна спросить пользователя о том, разрешать ли ей доступ в это приложение. Если пользователь разрешает ей доступ, то программа добавляет ее в список разрешенных. После чего 
происходит некоторое действие, в зависимости от команд приложения. После успешно выполненной команды приложения отправляет "GOOD", а в случае не успешного выполнения "BAD".


<h2>Пример работы</h2>
Программа 1 (Подкаст-менеджер) загружает подкасты.
Программа 2 (Программа синхронизации смартфона).

Программа 1 -> "WORK" -> Программа 2
Программа 2 -> "YES" -> Программа 1
Программа 1 -> "FILES TO SYNC\n...\n..." -> Программа 2
Программа 2 -> "GOOD" -> Программа 1

*Программа 1 передала название файлов программе 2, программа 2 загрузила файлы на смартфон, отправила программе 1 статус успешной загрузки, программа 1 удалила загруженные файлы.


<h2>Реализация на Delphi 7 с обработкой WM_COPYDATA</h2>

Получение
<blockquote>...
type
  TForm1 = class(TForm)
    Label1: TLabel;
  private
   procedure WMCopyData(var Msg: TWMCopyData); message WM_COPYDATA; //Наша функция
...
procedure TForm1.WMCopyData(var Msg: TWMCopyData);
begin
if copy(PChar(TWMCopyData(Msg).CopyDataStruct.lpData),1,4)='YES&' then ShowMessage('К нам пытается подключится программа');
Msg.Result:=Integer(True);
end;</blockquote>

Отправка
<blockquote>var
CDS: TCopyDataStruct;
begin
CDS.dwData:=0;
CDS.cbData:=(length('Команда')+ 1)*sizeof(char);
CDS.lpData:=PChar('Команда');
SendMessage(FindWindow(nil, 'Заголовок программы'),WM_COPYDATA, Integer(Handle), Integer(@CDS));
end;</blockquote>
